import os
import requests
from datetime import datetime

def tdcc_share_distribution():
    """
    下載 TDCC 集保戶股權分散表 CSV
    - 不需任何參數
    - 自動抓取固定網址
    - 檔名自動加上當天日期
    - 存在 ./data 資料夾
    """
    # 你的固定網址（TDCC 官網提供的下載鏈接）
    url = "https://opendata.tdcc.com.tw/getOD.ashx?id=1-5"

    # 確保儲存資料夾存在
    save_dir = "./data"
    os.makedirs(save_dir, exist_ok=True)

    # 產生帶日期的檔名
    today_str = datetime.today().strftime("%Y%m%d")
    file_name = f"tdcc_share_distribution_{today_str}.csv"
    file_path = os.path.join(save_dir, file_name)

    # 下載 CSV
    response = requests.get(url)
    response.raise_for_status()

    # 寫檔
    with open(file_path, "wb") as f:
        f.write(response.content)
    print(f"下載完成，已儲存到：{file_path}")